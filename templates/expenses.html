<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Transações</title>
    <link rel="stylesheet" href="/static/expenses/css/main.css">
</head>
<body data-user-type="{{ user_type }}">
    <header class="header">
        <button class="back-btn" onclick="goBack()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path d="m15 18-6-6 6-6"/>
            </svg>
        </button>
        <div class="header-content">
            <button class="logout-btn" onclick="handleLogout()">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                </svg>
                Sair
            </button>
        </div>
    </header>

    <main class="main-content">
        <div class="table-container">
            <div class="table-wrapper">
                <table class="transactions-table">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Descrição</th>
                            <th>Valor Bruto</th>
                            <th>IVA %</th>
                            <th>Valor IVA</th>
                            <th>Valor Líquido</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-tbody">
                    </tbody>
                </table>
            </div>
            
            <div id="empty-state" class="empty-state">
                <div class="empty-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                        <line x1="8" y1="21" x2="16" y2="21"/>
                        <line x1="12" y1="17" x2="12" y2="21"/>
                    </svg>
                </div>
                <h3>Nenhuma transação encontrada</h3>
                <p>Adicione a sua primeira transação clicando no botão abaixo</p>
            </div>
        </div>
    </main>

    <button class="fab" onclick="openModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
    </button>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Adicionar Transação</h2>
                <button class="close-btn" onclick="closeModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>

            <form id="transaction-form" class="modal-form" action="/add-expenses" method="POST">
                <div class="form-group">
                    <label for="type">Tipo de Transação</label>
                    <select name="transaction_type" id="type" required>
                        <option value="">Selecione o tipo</option>
                        <option value="ganho">Ganho</option>
                        <option value="despesa">Despesa</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="description">Descrição</label>
                    <input type="text" name="description" id="description" placeholder="Descrição da transação" required>
                </div>

                <div class="form-group">
                    <label for="gross-value">Valor Bruto (€)</label>
                    <input type="number" name="gross_value" id="gross-value" step="0.01" min="0" placeholder="0.00" required>
                </div>

                <div class="form-group">
                    <label for="iva-rate">Taxa de IVA (%)</label>
                    <select name="iva_rate" id="iva-rate">
                        <option value="0">0% (Isento)</option>
                        <option value="6">6% (Taxa reduzida)</option>
                        <option value="13">13% (Taxa intermédia)</option>
                        <option value="23" selected>23% (Taxa normal)</option>
                    </select>
                </div>

                <div class="calculated-values">
                    <div class="calc-row">
                        <span>Valor IVA:</span>
                        <span id="iva-value">€0.00</span>
                    </div>
                    <div class="calc-row">
                        <span>Valor Líquido:</span>
                        <span id="net-value">€0.00</span>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Adicionar</button>
                </div>
                <input type="hidden" name="iva_value" id="iva-value-input">
                <input type="hidden" name="net_value" id="net-value-input">
            </form>
        </div>
    </div>

    <script src="/static/expenses/js/main.js"></script>
</body>
</html>
